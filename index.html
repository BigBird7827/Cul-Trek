<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cultures Console</title>
  <style>
    :root {
      --bg0: #070a12;
      --bg1: #0b1630;
      --panel: rgba(14, 22, 46, 0.78);
      --panel2: rgba(9, 14, 30, 0.75);
      --gold: #d4b35e;
      --gold2: #f3d88a;
      --ink: #e8eefc;
      --muted: rgba(232, 238, 252, 0.72);
      --line: rgba(212, 179, 94, 0.55);
      --line2: rgba(212, 179, 94, 0.25);
      --shadow: 0 18px 38px rgba(0,0,0,0.55);
      --soft: 0 10px 22px rgba(0,0,0,0.42);
      --radius: 18px;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--ink);
      background:
        radial-gradient(1200px 800px at 20% 15%, rgba(88, 140, 255, 0.20), transparent 55%),
        radial-gradient(900px 600px at 85% 25%, rgba(212, 179, 94, 0.14), transparent 60%),
        linear-gradient(135deg, var(--bg0), var(--bg1));
      min-height: 100vh;
      overflow-x: hidden;
    }

    .wrap {
      width: min(1260px, calc(100% - 28px));
      margin: 16px auto 22px;
    }

    .topbar {
      display: flex;
      gap: 14px;
      align-items: center;
      justify-content: space-between;
      padding: 14px 14px 12px;
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(20, 30, 62, 0.82), rgba(8, 12, 26, 0.68));
      border: 2px solid var(--line);
      box-shadow: var(--shadow);
      position: sticky;
      top: 10px;
      z-index: 10;
      backdrop-filter: blur(10px);
      flex-wrap: wrap;
    }

    .brand {
      display: flex;
      flex-direction: column;
      gap: 2px;
      min-width: 240px;
    }

    .brand .title {
      font-size: 26px;
      line-height: 1.05;
      letter-spacing: 0.6px;
      font-weight: 800;
      background: linear-gradient(180deg, var(--gold2), var(--gold));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-shadow: 0 1px 0 rgba(0,0,0,0.35);
    }

    .brand .sub {
      font-size: 13px;
      color: var(--muted);
      letter-spacing: 0.4px;
    }

    .actions {
      display: flex;
      gap: 10px;
      align-items: center;
      justify-content: flex-end;
      flex-wrap: wrap;
    }

    .btn {
      appearance: none;
      border: 2px solid var(--line2);
      background: linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.04));
      color: var(--ink);
      border-radius: 14px;
      padding: 10px 14px;
      cursor: pointer;
      box-shadow: var(--soft);
      transition: transform 140ms ease, border-color 140ms ease, background 140ms ease;
      font-weight: 650;
      letter-spacing: 0.2px;
      white-space: nowrap;
    }

    
    #mainConsoleLink {
      width: fit-content;
      display: inline-flex;
      margin-top: 10px;
    }

    #clearBtn {
      margin-left: 75px;
    }
.btn:hover {
      transform: translateY(-1px);
      border-color: var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,0.14), rgba(255,255,255,0.06));
    }

    .btn:active { transform: translateY(0px); }

    .search {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 2px solid var(--line2);
      background: rgba(7, 10, 18, 0.40);
      box-shadow: var(--soft);
      width: min(260px, 23vw);
      min-width: min(260px, 23vw);
      max-width: min(260px, 23vw);
    }

    .search input {
      width: 100%;
      border: 0;
      outline: none;
      background: transparent;
      color: var(--ink);
      font-size: 15px;
      letter-spacing: 0.2px;
    }

    .search .pill {
      font-size: 12px;
      color: rgba(10, 12, 18, 0.9);
      background: linear-gradient(180deg, var(--gold2), var(--gold));
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,0.22);
      box-shadow: 0 8px 18px rgba(0,0,0,0.35);
      user-select: none;
    }

    .grid {
      display: grid;
      grid-template-columns: 400px 1fr;
      gap: 14px;
      margin-top: 14px;
    }

    .panel {
      border-radius: var(--radius);
      border: 2px solid var(--line2);
      background: linear-gradient(180deg, var(--panel), var(--panel2));
      box-shadow: var(--shadow);
      overflow: hidden;
    }

    .panelhead {
      padding: 12px 14px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid rgba(212, 179, 94, 0.22);
      background: linear-gradient(180deg, rgba(255,255,255,0.07), rgba(255,255,255,0.02));
    }

    .panelhead .label {
      font-weight: 800;
      letter-spacing: 0.4px;
      color: rgba(243, 216, 138, 0.98);
      text-shadow: 0 1px 0 rgba(0,0,0,0.35);
      font-size: 16px;
    }

    .panelbody { padding: 12px; }

    .list {
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }

    .card {
      border-radius: 16px;
      border: 2px solid rgba(212, 179, 94, 0.22);
      background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.03));
      box-shadow: 0 12px 24px rgba(0,0,0,0.35);
      padding: 12px;
      cursor: pointer;
      transition: transform 140ms ease, border-color 140ms ease, background 140ms ease;
      display: grid;
      grid-template-columns: 56px 1fr;
      gap: 12px;
      align-items: center;
    }

    .card:hover {
      transform: translateY(-1px);
      border-color: rgba(212, 179, 94, 0.55);
      background: linear-gradient(180deg, rgba(255,255,255,0.12), rgba(255,255,255,0.05));
    }

    .card.active {
      border-color: rgba(243, 216, 138, 0.92);
      box-shadow: 0 16px 32px rgba(0,0,0,0.45);
    }

    .sigil {
      width: 56px;
      height: 56px;
      border-radius: 16px;
      border: 2px solid rgba(212, 179, 94, 0.40);
      background:
        radial-gradient(30px 30px at 30% 30%, rgba(243, 216, 138, 0.30), transparent 55%),
        linear-gradient(180deg, rgba(18, 26, 54, 0.92), rgba(8, 12, 26, 0.80));
      box-shadow: 0 12px 22px rgba(0,0,0,0.35);
      display: grid;
      place-items: center;
      font-weight: 900;
      color: rgba(243, 216, 138, 0.95);
      letter-spacing: 0.5px;
      text-shadow: 0 1px 0 rgba(0,0,0,0.45);
      user-select: none;
    }

    .card .name {
      font-weight: 850;
      letter-spacing: 0.3px;
      font-size: 16px;
      line-height: 1.2;
    }

    .card .meta {
      margin-top: 3px;
      font-size: 12.5px;
      color: var(--muted);
      line-height: 1.25;
      white-space: pre-wrap;
    }

    .detailTop {
      display: grid;
      grid-template-columns: 170px 1fr;
      gap: 14px;
      align-items: center;
    }

    .hero {
      width: 170px;
      height: 170px;
      border-radius: 22px;
      border: 2px solid rgba(243, 216, 138, 0.60);
      background:
        radial-gradient(120px 120px at 35% 25%, rgba(88, 140, 255, 0.28), transparent 62%),
        radial-gradient(120px 120px at 70% 70%, rgba(243, 216, 138, 0.20), transparent 62%),
        linear-gradient(180deg, rgba(18, 26, 54, 0.90), rgba(8, 12, 26, 0.78));
      box-shadow: 0 18px 32px rgba(0,0,0,0.45);
      display: grid;
      place-items: center;
      overflow: hidden;
      position: relative;
    }

    .hero .mark {
      font-size: 74px;
      font-weight: 950;
      background: linear-gradient(180deg, var(--gold2), var(--gold));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-shadow: 0 2px 0 rgba(0,0,0,0.28);
      letter-spacing: 1px;
      transform: translateY(-2px);
      user-select: none;
    }

    .hero img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: none;
    }

    .h1 {
      font-size: 30px;
      font-weight: 900;
      letter-spacing: 0.6px;
      margin: 0 0 4px;
      background: linear-gradient(180deg, var(--gold2), var(--gold));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-shadow: 0 1px 0 rgba(0,0,0,0.40);
    }

    .h1::after {
      content: "";
      display: block;
      height: 4px;
      margin-top: 8px;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(243, 216, 138, 0.0), rgba(243, 216, 138, 0.85), rgba(212, 179, 94, 0.85), rgba(243, 216, 138, 0.0));
      box-shadow: 0 8px 18px rgba(212, 179, 94, 0.22);
    }

    .lede {
      margin-top: 10px;
      color: rgba(232, 238, 252, 0.84);
      line-height: 1.45;
      font-size: 15px;
    }

    .kv {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 14px;
    }

    .tile {
      border-radius: 16px;
      border: 2px solid rgba(212, 179, 94, 0.22);
      background: linear-gradient(180deg, rgba(255,255,255,0.07), rgba(255,255,255,0.03));
      box-shadow: 0 12px 22px rgba(0,0,0,0.30);
      padding: 12px;
    }

    .tile .k {
      font-size: 12px;
      letter-spacing: 0.6px;
      text-transform: uppercase;
      color: rgba(243, 216, 138, 0.92);
      margin-bottom: 6px;
      font-weight: 850;
    }

    .tile .v {
      font-size: 14.5px;
      color: rgba(232, 238, 252, 0.86);
      line-height: 1.35;
      white-space: pre-wrap;
    }

    .sections {
      margin-top: 12px;
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }

    .section {
      border-radius: 16px;
      border: 2px solid rgba(212, 179, 94, 0.18);
      background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
      padding: 12px;
    }

    .section h3 {
      margin: 0 0 6px;
      font-size: 14px;
      letter-spacing: 0.5px;
      text-transform: uppercase;
      color: rgba(243, 216, 138, 0.92);
    }

    .section p {
      margin: 0;
      color: rgba(232, 238, 252, 0.86);
      line-height: 1.5;
      font-size: 14.5px;
      white-space: pre-wrap;
    }

    .chips {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 6px;
    }

    .chip {
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid rgba(212, 179, 94, 0.32);
      background: rgba(7, 10, 18, 0.28);
      color: rgba(232, 238, 252, 0.84);
      font-size: 12.5px;
      box-shadow: 0 10px 18px rgba(0,0,0,0.28);
    }

    .empty {
      padding: 18px 14px;
      border-radius: 16px;
      border: 2px dashed rgba(212, 179, 94, 0.25);
      color: rgba(232, 238, 252, 0.72);
      line-height: 1.45;
      background: rgba(7, 10, 18, 0.20);
    }

    .foot {
      margin-top: 14px;
      color: rgba(232, 238, 252, 0.55);
      font-size: 12px;
      text-align: center;
      letter-spacing: 0.3px;
    }

    @media (max-width: 980px) {
      .grid { grid-template-columns: 1fr; }
      .search { min-width: 0; width: 100%; }
      .brand { min-width: 0; }
      .detailTop { grid-template-columns: 1fr; }
      .hero { width: 100%; height: 220px; }
      .kv { grid-template-columns: 1fr; }
    }
  
    .titlebox {
      width: calc(100% - 50px);
      margin: 0 25px 14px 25px;
      padding: 14px 25px;
      box-sizing: border-box;
      text-align: left;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,0)), var(--panel);
      border: 1px solid var(--edge);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }

</style>
</head>
<body>
<div class="wrap">
    <div class="topbar">
        <div class="titlebox">
    <div class="brand">
        <div class="title">Cultures Console</div>
        <div class="sub">Star Trek cultures & societies (canon)</div>
      </div>

    <a id="mainConsoleLink" class="btn" href="https://bigbird7827.github.io/Main-Console/">MAIN CONSOLE</a>
  </div>

      <div class="search">
        <span class="pill">SEARCH</span>
        <input id="searchInput" type="text" placeholder="Type to search cultures (e.g., Klingon, Bajoran, Vulcan)..." autocomplete="off" />
      </div>

      <div class="actions">
        <button class="btn" id="clearBtn">Clear</button>
</div>
    </div>

    <div class="grid">
      <div class="panel">
        <div class="panelhead">
          <div class="label">Culture List</div>
          <div class="label" id="countLabel" style="opacity:.85;font-weight:800;font-size:13px;"></div>
        </div>
        <div class="panelbody">
          <div class="list" id="list"></div>
        </div>
      </div>

      <div class="panel">
        <div class="panelhead">
          <div class="label">Detail View</div>
          <div class="label" id="detailTag" style="opacity:.85;font-weight:800;font-size:13px;"></div>
        </div>
        <div class="panelbody" id="detail"></div>
      </div>
    </div>

    <div class="foot">External JSON build. Next step: expand the roster and fill in entries.</div>
  </div>

  <script>
    let culturesData = [];
    const DATA_URL = "https://raw.githubusercontent.com/BigBird7827/Cul-Trek/main/Cultures.json";

    const state = {
      query: "",
      selectedId: null
    };

    const elList = document.getElementById("list");
    const elDetail = document.getElementById("detail");
    const elSearch = document.getElementById("searchInput");
    const elCount = document.getElementById("countLabel");
    const elDetailTag = document.getElementById("detailTag");
    const elClear = document.getElementById("clearBtn");

    const norm = (s) => (s || "").toString().trim().toLowerCase();

    const normalizeCulture = (c) => {
      const id = c.ID || c.id || "";
      const name = c.Name || c.name || "";
      const species = c.SpeciesOrPeople || c.speciesOrPeople || "";
      const affiliations = c.Affiliation || c.affiliation || [];
      const homeworlds = c.PrimaryHomeworlds || c.primaryHomeworlds || [];
      const regions = c.Regions || c.regions || [];
      const overview = c.Overview || c.overview || [];
      const coreTraits = (c.CoreTraits || c.coreTraits || []).map(x => x && x.Trait).filter(Boolean);
      const customs = c.Customs || c.customs || [];
      const everydayLife = c.EverydayLife || c.everydayLife || {};
      const relations = c.Relations || c.relations || {};
      const keyAppearances = c.KeyAppearances || c.keyAppearances || [];
      const related = c.RelatedEntries || c.relatedEntries || {};

      return {
        id,
        name,
        species,
        affiliations: Array.isArray(affiliations) ? affiliations : [affiliations].filter(Boolean),
        homeworlds: Array.isArray(homeworlds) ? homeworlds : [homeworlds].filter(Boolean),
        regions: Array.isArray(regions) ? regions : [regions].filter(Boolean),
        overview: Array.isArray(overview) ? overview : (overview ? [overview] : []),
        coreTraits,
        customs: Array.isArray(customs) ? customs : [],
        everydayLife: everydayLife || {},
        relations: relations || {},
        keyAppearances: Array.isArray(keyAppearances) ? keyAppearances : [],
        related: related || {}
      };
    };

    const getFiltered = () => {
      const q = norm(state.query);
      if (!q) return culturesData.slice();
      return culturesData.filter(c => {
        const hay = [
          c.name,
          c.species,
          ...(c.affiliations || []),
          ...(c.homeworlds || []),
          ...(c.regions || []),
          ...(c.coreTraits || []),
          ...((c.relations && c.relations.CommonMisreads) ? c.relations.CommonMisreads : [])
        ].map(norm).join(" | ");
        return hay.includes(q);
      });
    };

    const makeCard = (c) => {
      const card = document.createElement("div");
      card.className = "card" + (c.id === state.selectedId ? " active" : "");
      card.tabIndex = 0;
      card.setAttribute("role", "button");
      card.setAttribute("aria-label", "Open " + (c.name || "culture"));

      const sigil = document.createElement("div");
      sigil.className = "sigil";
      sigil.textContent = (c.name || "?").slice(0, 1).toUpperCase();

      const main = document.createElement("div");
      main.className = "main";

      const name = document.createElement("div");
      name.className = "name";
      name.textContent = c.name || "Unknown";

      const meta = document.createElement("div");
      meta.className = "meta";

      const hw = c.homeworlds && c.homeworlds.length ? "Homeworld: " + c.homeworlds[0] : "";
      const reg = c.regions && c.regions.length ? "Region: " + c.regions.join(", ") : "";
      const aff = c.affiliations && c.affiliations.length ? "Affiliation: " + c.affiliations[0] : "";
      meta.textContent = [hw, reg, aff].filter(Boolean).join("
");

      main.appendChild(name);
      main.appendChild(meta);

      card.appendChild(sigil);
      card.appendChild(main);

      const select = () => {
        state.selectedId = c.id;
        render();
      };

      card.addEventListener("click", select);
      card.addEventListener("keydown", (e) => {
        if (e.key === "Enter" || e.key === " ") {
          e.preventDefault();
          select();
        }
      });

      return card;
    };

    const renderList = () => {
      const items = getFiltered();
      elList.innerHTML = "";
      items.forEach(c => elList.appendChild(makeCard(c)));
      elCount.textContent = items.length ? (items.length + " culture" + (items.length === 1 ? "" : "s")) : "0 cultures";
    };

    const chips = (arr) => {
      const wrap = document.createElement("div");
      wrap.className = "chips";
      (arr || []).forEach(t => {
        const c = document.createElement("div");
        c.className = "chip";
        c.textContent = t;
        wrap.appendChild(c);
      });
      return wrap;
    };

    const tile = (k, v) => {
      const t = document.createElement("div");
      t.className = "tile";
      const kk = document.createElement("div");
      kk.className = "k";
      kk.textContent = k;
      const vv = document.createElement("div");
      vv.className = "v";
      vv.textContent = v || "—";
      t.appendChild(kk);
      t.appendChild(vv);
      return t;
    };

    const section = (title, text) => {
      const s = document.createElement("div");
      s.className = "section";
      const h = document.createElement("h3");
      h.textContent = title;
      const p = document.createElement("p");
      p.textContent = text || "—";
      s.appendChild(h);
      s.appendChild(p);
      return s;
    };

    const sectionParagraphs = (title, paras) => {
      const s = document.createElement("div");
      s.className = "section";
      const h = document.createElement("h3");
      h.textContent = title;
      s.appendChild(h);

      const pList = (paras || []).filter(Boolean);
      if (!pList.length) {
        const p = document.createElement("p");
        p.textContent = "—";
        s.appendChild(p);
        return s;
      }

      pList.forEach(txt => {
        const p = document.createElement("p");
        p.textContent = txt;
        s.appendChild(p);
      });
      return s;
    };

    const sectionCustoms = (title, customs) => {
      const s = document.createElement("div");
      s.className = "section";
      const h = document.createElement("h3");
      h.textContent = title;
      s.appendChild(h);

      const items = (customs || []).filter(x => x && (x.Name || x.WhatItIs || x.WhyItMatters));
      if (!items.length) {
        const p = document.createElement("p");
        p.textContent = "—";
        s.appendChild(p);
        return s;
      }

      items.forEach(x => {
        const box = document.createElement("div");
        box.style.marginTop = "10px";

        const n = document.createElement("div");
        n.style.fontWeight = "900";
        n.style.color = "rgba(232,238,252,0.92)";
        n.textContent = x.Name || "Custom";

        const w = document.createElement("div");
        w.style.marginTop = "4px";
        w.style.color = "rgba(232,238,252,0.78)";
        w.textContent = x.WhatItIs || "—";

        const y = document.createElement("div");
        y.style.marginTop = "4px";
        y.style.color = "rgba(232,238,252,0.72)";
        y.textContent = x.WhyItMatters ? ("Why it matters: " + x.WhyItMatters) : "Why it matters: —";

        box.appendChild(n);
        box.appendChild(w);
        box.appendChild(y);
        s.appendChild(box);
      });

      return s;
    };

    const sectionKeyAppearances = (title, apps) => {
      const s = document.createElement("div");
      s.className = "section";
      const h = document.createElement("h3");
      h.textContent = title;
      s.appendChild(h);

      const items = (apps || []).filter(x => x && (x.Title || x.Series));
      if (!items.length) {
        const p = document.createElement("p");
        p.textContent = "—";
        s.appendChild(p);
        return s;
      }

      items.forEach(x => {
        const line = document.createElement("div");
        line.style.marginTop = "10px";

        const t = document.createElement("div");
        t.style.fontWeight = "900";
        t.style.color = "rgba(232,238,252,0.92)";
        const se = (x.Series && x.Season != null && x.Episode != null) ? (x.Series + " S" + x.Season + "E" + x.Episode) : (x.Series || "");
        t.textContent = [se, x.Title].filter(Boolean).join(" — ");

        const why = document.createElement("div");
        why.style.marginTop = "4px";
        why.style.color = "rgba(232,238,252,0.78)";
        why.textContent = x.WhyRelevant || "—";

        line.appendChild(t);
        line.appendChild(why);
        s.appendChild(line);
      });

      return s;
    };

    const renderDetail = () => {
      const c = culturesData.find(x => x.id === state.selectedId);
      elDetail.innerHTML = "";

      if (!c) {
        const empty = document.createElement("div");
        empty.className = "empty";
        empty.textContent = "Select a culture from the list to view details.";
        elDetail.appendChild(empty);
        elDetailTag.textContent = "";
        return;
      }

      elDetailTag.textContent = c.id || "";

      const hero = document.createElement("div");
      hero.className = "hero";

      const mark = document.createElement("div");
      mark.className = "mark";
      mark.textContent = (c.name || "?").slice(0, 1).toUpperCase();
      hero.appendChild(mark);

      const head = document.createElement("div");

      const h1 = document.createElement("div");
      h1.className = "h1";
      h1.textContent = c.name || "Unknown";

      const lede = document.createElement("div");
      lede.className = "lede";
      lede.textContent = (c.overview && c.overview.length) ? c.overview[0] : "";

      head.appendChild(h1);
      head.appendChild(lede);

      const top = document.createElement("div");
      top.className = "top";
      top.appendChild(hero);
      top.appendChild(head);

      elDetail.appendChild(top);

      const kv = document.createElement("div");
      kv.className = "kv";
      kv.appendChild(tile("People / Culture", c.species || "—"));
      kv.appendChild(tile("Homeworlds", (c.homeworlds || []).join(", ")));
      kv.appendChild(tile("Regions", (c.regions || []).join(", ")));
      kv.appendChild(tile("Affiliation", (c.affiliations || []).join(", ")));
      elDetail.appendChild(kv);

      elDetail.appendChild(sectionParagraphs("Overview", c.overview));

      const traits = document.createElement("div");
      traits.className = "section";
      const th = document.createElement("h3");
      th.textContent = "Core traits";
      traits.appendChild(th);
      traits.appendChild(chips(c.coreTraits || []));
      elDetail.appendChild(traits);

      elDetail.appendChild(sectionCustoms("Customs", c.customs || []));

      const fam = (c.everydayLife && c.everydayLife.FamilyAndSociety) ? c.everydayLife.FamilyAndSociety : "";
      elDetail.appendChild(section("Family & society", fam));

      const food = (c.everydayLife && c.everydayLife.FoodAndDrink) ? c.everydayLife.FoodAndDrink : "";
      elDetail.appendChild(section("Food & drink", food));

      const relText = (c.relations && c.relations.WithStarfleet) ? c.relations.WithStarfleet : "";
      elDetail.appendChild(section("Relations with Starfleet", relText));

      const misreads = (c.relations && Array.isArray(c.relations.CommonMisreads)) ? c.relations.CommonMisreads : [];
      const mr = document.createElement("div");
      mr.className = "section";
      const mrh = document.createElement("h3");
      mrh.textContent = "Common misreads";
      mr.appendChild(mrh);
      mr.appendChild(chips(misreads));
      elDetail.appendChild(mr);

      elDetail.appendChild(sectionKeyAppearances("Key appearances", c.keyAppearances || []));

      const relatedWrap = document.createElement("div");
      relatedWrap.className = "section";
      const rh = document.createElement("h3");
      rh.textContent = "Related entries";
      relatedWrap.appendChild(rh);

      const relGrid = document.createElement("div");
      relGrid.className = "kv";

      const people = (c.related && Array.isArray(c.related.People)) ? c.related.People : [];
      const orgs = (c.related && Array.isArray(c.related.Organizations)) ? c.related.Organizations : [];
      const planets = (c.related && Array.isArray(c.related.Planets)) ? c.related.Planets : [];
      const arts = (c.related && Array.isArray(c.related.Artifacts)) ? c.related.Artifacts : [];

      const relTile = (label, arr) => {
        const t = document.createElement("div");
        t.className = "tile";
        const kk = document.createElement("div");
        kk.className = "k";
        kk.textContent = label;
        const vv = document.createElement("div");
        vv.className = "v";
        vv.textContent = "";
        t.appendChild(kk);
        t.appendChild(vv);
        t.appendChild(chips(arr || []));
        return t;
      };

      relGrid.appendChild(relTile("People", people));
      relGrid.appendChild(relTile("Organizations", orgs));
      relGrid.appendChild(relTile("Planets", planets));
      relGrid.appendChild(relTile("Artifacts", arts));

      relatedWrap.appendChild(relGrid);
      elDetail.appendChild(relatedWrap);
    };

    const render = () => {
      renderList();
      renderDetail();
    };

    const load = async () => {
      try {
        const res = await fetch(DATA_URL, { cache: "no-store" });
        if (!res.ok) throw new Error("HTTP " + res.status);
        const raw = await res.json();
        const arr = Array.isArray(raw) ? raw : (raw && Array.isArray(raw.Cultures) ? raw.Cultures : []);
        culturesData = arr.map(normalizeCulture).filter(x => x.id || x.name);

        if (!culturesData.length) {
          elList.innerHTML = '<div class="empty">No culture data found.</div>';
          elCount.textContent = "0 cultures";
          return;
        }

        if (!state.selectedId) state.selectedId = culturesData[0].id;
        render();
      } catch (err) {
        elList.innerHTML = '<div class="empty">Failed to load data. Check the JSON URL and CORS access.</div>';
        elCount.textContent = "";
        elDetail.innerHTML = '<div class="empty">' + (err && err.message ? err.message : "Error") + "</div>";
      }
    };

    elSearch.addEventListener("input", (e) => {
      state.query = e.target.value || "";
      const items = getFiltered();
      if (items.length && (!state.selectedId || !items.some(x => x.id === state.selectedId))) {
        state.selectedId = items[0].id;
      }
      render();
    });

    elClear.addEventListener("click", () => {
      state.query = "";
      elSearch.value = "";
      if (culturesData.length) state.selectedId = culturesData[0].id;
      render();
      elSearch.focus();
    });

    load();
  </script>
</body>
</html>
